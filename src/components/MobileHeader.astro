---
---

<header class="mobile-header">
  <div class="mobile-logo-wrapper">
    <img class="mobile-logo" src="/images/logo.svg" alt="VirÅ¡upis" />
  </div>
  <button class="mobile-menu-btn" aria-label="Menu">
    <img src="/images/Menu icon.svg" alt="" />
  </button>
</header>

<!-- Spacer to push content down on mobile -->
<div class="mobile-header-spacer"></div>

<style>
  .mobile-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background-color: #F5F3EE;
    display: flex;
    align-items: center;
    padding: 24px 16px;
  }

  .mobile-logo-wrapper {
    width: 100%;
    aspect-ratio: 6.89 / 1;
  }

  .mobile-logo {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .mobile-menu-btn {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    opacity: 0;
    visibility: hidden;
  }

  .mobile-menu-btn img {
    display: block;
    width: 24px;
    height: auto;
  }

  .mobile-header-spacer {
    display: block;
    height: 120px;
  }

  @media (min-width: 768px) {
    .mobile-header,
    .mobile-header-spacer {
      display: none !important;
    }
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  ScrollTrigger.config({
    ignoreMobileResize: true,
  });

  ScrollTrigger.matchMedia({
    "(max-width: 767px)": function () {
      const header = document.querySelector(".mobile-header") as HTMLElement;
      const logoWrapper = document.querySelector(".mobile-logo-wrapper") as HTMLElement;
      const menuBtn = document.querySelector(".mobile-menu-btn") as HTMLElement;
      const spacer = document.querySelector(".mobile-header-spacer") as HTMLElement;

      if (!header || !logoWrapper || !menuBtn || !spacer) return;

      const logoAspectRatio = 6.89;
      const collapsedHeight = 63;
      const collapsedLogoWidth = 200;

      const getExpandedLogoWidth = () => window.innerWidth - 32;

      const getExpandedHeight = () => {
        const logoWidth = getExpandedLogoWidth();
        const logoHeight = logoWidth / logoAspectRatio;
        return 24 + logoHeight + 24;
      };

      const setInitialState = () => {
        gsap.set(logoWrapper, { width: getExpandedLogoWidth() });
        gsap.set(menuBtn, { autoAlpha: 0 });
        gsap.set(spacer, { height: getExpandedHeight() });
      };

      setInitialState();

      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: document.body,
          start: "50px top",
          end: "150px top",
          scrub: true,
          invalidateOnRefresh: true,
          onRefresh: () => {
            if (window.scrollY < 50) {
              setInitialState();
            }
          },
        },
      });

      tl.fromTo(
        logoWrapper,
        { width: getExpandedLogoWidth() },
        { width: collapsedLogoWidth, ease: "none" },
        0
      )
        .to(
          menuBtn,
          { autoAlpha: 1, ease: "none" },
          0
        )
        .fromTo(
          header,
          { height: getExpandedHeight(), padding: "24px 16px" },
          { height: collapsedHeight, padding: "0 16px", ease: "none" },
          0
        )
        .fromTo(
          spacer,
          { height: getExpandedHeight() },
          { height: collapsedHeight, ease: "none" },
          0
        );

      ScrollTrigger.refresh();

      return function () {};
    },
  });

  let resizeTimeout: ReturnType<typeof setTimeout>;
  window.addEventListener("resize", () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => ScrollTrigger.refresh(), 100);
  });

  window.addEventListener("orientationchange", () => {
    setTimeout(() => ScrollTrigger.refresh(), 100);
  });
</script>
