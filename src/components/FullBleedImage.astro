---
interface Props {
  src: string;
  mobileSrc?: string;
  alt: string;
  parallax?: boolean;
  height?: number;
}

const { src, mobileSrc, alt, parallax = false, height = 850 } = Astro.props;
---

<section
  class:list={["full-bleed-image", { "parallax-enabled": parallax }]}
  style={`height: ${height}px;`}
>
  {mobileSrc ? (
    <picture>
      <source media="(max-width: 768px)" srcset={mobileSrc} />
      <img src={src} alt={alt} loading="lazy" style={parallax ? `height: ${height}px;` : undefined} />
    </picture>
  ) : (
    <img src={src} alt={alt} loading="lazy" style={parallax ? `height: ${height}px;` : undefined} />
  )}
</section>

<style>
  .full-bleed-image {
    width: 100%;
    overflow: hidden;
    background-color: #e5e0d8;
    position: relative;
    transform-origin: center center;
    will-change: transform;
  }

  .full-bleed-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    transform-origin: center;
    will-change: transform;
  }

  /* Parallax mode: image stays fixed while content scrolls over */
  .full-bleed-image.parallax-enabled {
    /* Container clips the sticky image */
    clip-path: inset(0);
  }

  .full-bleed-image.parallax-enabled img {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    object-fit: cover;
    object-position: center;
    z-index: 0;
    transform-origin: center center;
    will-change: transform;
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const fullBleedSections = document.querySelectorAll('.full-bleed-image');

  fullBleedSections.forEach((section) => {
    gsap.fromTo(section,
      { scale: 1 },
      {
        scale: 1.05,
        duration: 3.5,
        ease: 'power2.out',
        scrollTrigger: {
          trigger: section,
          start: 'top 15%',
          toggleActions: 'play none none none',
        }
      }
    );
  });
</script>
