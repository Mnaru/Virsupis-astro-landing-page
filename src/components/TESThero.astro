---
interface Props {
  image?: string;
  mobileImage?: string;
  alt?: string;
}

const {
  image = "/images/Hero%20image.webp",
  mobileImage = "/images/Hero%20image%20mobile.webp",
  alt = "Viršupis - privatus namų kvartalas"
} = Astro.props;
---

<section class="test-hero">
  <picture>
    <source media="(max-width: 768px)" srcset={mobileImage} />
    <img
      src={image}
      alt={alt}
      class="test-hero-image"
      loading="eager"
      fetchpriority="high"
    />
  </picture>
</section>

<!-- Spacer to push content below fixed hero -->
<div class="test-hero-spacer"></div>

<style>
  .test-hero {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 1;
    background-color: black;
  }

  .test-hero-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .test-hero-spacer {
    height: 120vh;
    position: relative;
    z-index: 1;
  }

  @media (max-width: 768px) {
    .test-hero {
      height: 100svh;
    }

    .test-hero-image {
      object-position: center bottom;
    }

    .test-hero-spacer {
      height: 120svh;
    }
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  ScrollTrigger.config({
    ignoreMobileResize: true,
  });

  const heroImage = document.querySelector('.test-hero-image');
  const heroSpacer = document.querySelector('.test-hero-spacer');

  if (heroImage && heroSpacer) {
    // Set initial zoom state
    gsap.set(heroImage, { scale: 1.05 });

    const testHero = document.querySelector('.test-hero');

    ScrollTrigger.matchMedia({
      // Desktop (769px and up)
      "(min-width: 769px)": function() {
        // Animation (zoom/fade)
        gsap.fromTo(
          heroImage,
          { scale: 1.05, opacity: 1 },
          {
            scale: 1.0,
            opacity: 0.3,
            ease: 'none',
            scrollTrigger: {
              trigger: heroSpacer,
              start: '10% top',
              end: '60% top',
              scrub: 0.5,
            }
          }
        );

        // Visibility toggle (separate - hide only when fully scrolled past)
        ScrollTrigger.create({
          trigger: heroSpacer,
          start: 'bottom top',
          onEnter: () => gsap.set(testHero, { visibility: 'hidden' }),
          onLeaveBack: () => gsap.set(testHero, { visibility: 'visible' }),
        });
      },

      // Mobile (768px and below)
      "(max-width: 768px)": function() {
        // Animation (zoom/fade)
        gsap.fromTo(
          heroImage,
          { scale: 1.05, opacity: 1 },
          {
            scale: 1.0,
            opacity: 0.3,
            ease: 'none',
            scrollTrigger: {
              trigger: heroSpacer,
              start: '10% top',
              end: '60% top',
              scrub: 0.5,
            }
          }
        );

        // Visibility toggle (separate - hide only when fully scrolled past)
        ScrollTrigger.create({
          trigger: heroSpacer,
          start: 'bottom top',
          onEnter: () => gsap.set(testHero, { visibility: 'hidden' }),
          onLeaveBack: () => gsap.set(testHero, { visibility: 'visible' }),
        });
      }
    });
  }
</script>
