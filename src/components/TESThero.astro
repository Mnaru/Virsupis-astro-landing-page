---
interface Props {
  image?: string;
  mobileImage?: string;
  alt?: string;
}

const {
  image = "/images/Hero%20image.webp",
  mobileImage = "/images/Hero%20image%20mobile.webp",
  alt = "Viršupis - privatus namų kvartalas"
} = Astro.props;
---

<section class="test-hero" aria-label={alt}>
  <div class="test-hero-bg" style={`--desktop-bg: url('${image}'); --mobile-bg: url('${mobileImage}')`}></div>
</section>

<!-- Spacer to push content below fixed hero -->
<div class="test-hero-spacer"></div>

<style>
  .test-hero {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 1;
    background-color: black;
    overflow: hidden;
  }

  .test-hero-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: var(--desktop-bg);
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    transform: scale(1.05); /* Initial state for zoom animation */
  }

  .test-hero-spacer {
    height: 100vh;
    position: relative;
    z-index: 1;
  }

  @media (max-width: 768px) {
    .test-hero {
      /* Use --vh custom property set by JS - stable during toolbar show/hide */
      height: calc(var(--vh, 1vh) * 95);
    }

    .test-hero-bg {
      background-image: var(--mobile-bg);
      background-size: cover;
      background-position: center center;
      transform: scale(1.05); /* Initial state for mobile zoom animation */
    }

    .test-hero-spacer {
      /* Reduced height creates overlap effect without negative margins */
      /* Negative margins cause ScrollTrigger position miscalculations */
      height: calc(var(--vh, 1vh) * 95 - 100px);
    }
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  // ScrollTrigger.config() is set globally in scrollTriggerInit.ts

  const heroBg = document.querySelector('.test-hero-bg');
  const heroSpacer = document.querySelector('.test-hero-spacer');

  if (heroBg && heroSpacer) {
    const testHero = document.querySelector('.test-hero');

    ScrollTrigger.matchMedia({
      // Desktop (769px and up)
      "(min-width: 769px)": function() {
        // Zoom out and fade to black
        gsap.fromTo(
          heroBg,
          { scale: 1.05, opacity: 1 },
          {
            scale: 1.0,
            opacity: 0,
            ease: 'none',
            scrollTrigger: {
              trigger: heroSpacer,
              start: '10% top',
              end: '60% top',
              scrub: 0.5,
            }
          }
        );

        // Visibility toggle (separate - hide only when fully scrolled past)
        ScrollTrigger.create({
          trigger: heroSpacer,
          start: 'bottom top',
          onEnter: () => gsap.set(testHero, { visibility: 'hidden' }),
          onLeaveBack: () => gsap.set(testHero, { visibility: 'visible' }),
        });
      },

      // Mobile (768px and below)
      "(max-width: 768px)": function() {
        // Animation (zoom/fade)
        gsap.fromTo(
          heroBg,
          { scale: 1.05, opacity: 1 },
          {
            scale: 1.0,
            opacity: 0.3,
            ease: 'none',
            scrollTrigger: {
              trigger: heroSpacer,
              start: '10% top',
              end: '60% top',
              scrub: 0.5,
            }
          }
        );

        // Visibility toggle (separate - hide only when fully scrolled past)
        ScrollTrigger.create({
          trigger: heroSpacer,
          start: 'bottom top',
          onEnter: () => gsap.set(testHero, { visibility: 'hidden' }),
          onLeaveBack: () => gsap.set(testHero, { visibility: 'visible' }),
        });
      }
    });
  }
</script>
