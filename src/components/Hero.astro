---
interface Props {
  image: string;
  mobileImage?: string;
  alt?: string;
}

const { image, mobileImage, alt = "" } = Astro.props;
---

<section class="hero">
  <picture>
    {mobileImage && <source media="(max-width: 768px)" srcset={mobileImage} />}
    <img id="hero-image" src={image} alt={alt} class="hero-image" loading="eager" fetchpriority="high" />
  </picture>
</section>

<!-- Spacer to push content below fixed hero -->
<div id="hero-spacer" class="hero-spacer"></div>

<style>
  .hero {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 850px;
    overflow: hidden;
    z-index: 1;
    background-color: #000;
  }

  .hero picture {
    display: block;
    width: 100%;
    height: 100%;
  }

  .hero-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    transform-origin: center center;
  }

  .hero-spacer {
    height: 850px;
    position: relative;
    z-index: 1;
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  // Prevent scroll recalculation on mobile toolbar show/hide
  ScrollTrigger.config({
    ignoreMobileResize: true,
  });

  const heroImage = document.getElementById("hero-image");
  const heroSpacer = document.getElementById("hero-spacer");

  if (heroImage && heroSpacer) {
    // Create scroll-linked animation for hero effects
    gsap.fromTo(
      heroImage,
      {
        opacity: 1,
        scale: 1,
      },
      {
        opacity: 0.3,
        scale: 0.95,
        ease: "none",
        scrollTrigger: {
          trigger: heroSpacer,
          start: "top top",
          end: "bottom top",
          scrub: 0.5,
        },
      }
    );
  }
</script>
