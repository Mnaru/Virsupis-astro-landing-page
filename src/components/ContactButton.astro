---
interface Props {
  email: string;
  class?: string;
}

const { email, class: className } = Astro.props;
---

<contact-button class={className} data-email={email}>
  <a
    href={`mailto:${email}`}
    class="inline-block text-white hover:text-[var(--color-accent)] transition-colors uppercase tracking-widest text-sm"
  >
    Kontaktai
  </a>
</contact-button>

<script>
  class ContactButton extends HTMLElement {
    private tooltip: HTMLDivElement | null = null;

    connectedCallback() {
      const email = this.dataset.email;
      const link = this.querySelector("a");

      if (!email || !link) return;

      // Check if device supports hover (desktop)
      const isDesktop = window.matchMedia("(hover: hover)").matches;

      if (isDesktop) {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          this.copyToClipboard(email);
        });
      }
    }

    async copyToClipboard(text: string) {
      try {
        await navigator.clipboard.writeText(text);
        this.showTooltip("Nukopijuota!");
      } catch (err) {
        // Fallback for older browsers
        this.fallbackCopy(text);
      }
    }

    fallbackCopy(text: string) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      textArea.style.position = "fixed";
      textArea.style.left = "-9999px";
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand("copy");
        this.showTooltip("Nukopijuota!");
      } catch (err) {
        this.showTooltip("Klaida");
      }
      document.body.removeChild(textArea);
    }

    showTooltip(message: string) {
      if (this.tooltip) {
        this.tooltip.remove();
      }

      this.tooltip = document.createElement("div");
      this.tooltip.textContent = message;
      this.tooltip.className =
        "absolute -top-10 left-1/2 -translate-x-1/2 bg-white text-black px-3 py-1 rounded text-sm whitespace-nowrap";
      this.style.position = "relative";
      this.appendChild(this.tooltip);

      setTimeout(() => {
        this.tooltip?.remove();
        this.tooltip = null;
      }, 2000);
    }
  }

  customElements.define("contact-button", ContactButton);
</script>
